{% extends "base.html" %}
{% load static i18n %}
{% block title %}{% trans "Verify" %}{% endblock %}
{% block body %}
<div class="salla-shell">
  <div class="salla-card">
    <div class="salla-topbar">
      <form action="{% url 'set_language' %}" method="post" style="display:inline;">
        {% csrf_token %}
        <input name="next" type="hidden" value="{{ request.get_full_path }}">
        {% get_current_language as LANGUAGE_CODE %}
        {% if LANGUAGE_CODE == 'ar' %}
          <input type="hidden" name="language" value="en">
          <button class="salla-lang" type="submit">English</button>
        {% else %}
          <input type="hidden" name="language" value="ar">
          <button class="salla-lang" type="submit">العربية</button>
        {% endif %}
      </form>
      <div class="salla-brand">
        <img src="{% static 'images/logo.jpeg' %}" alt="Wasla">
      </div>
    </div>

    <div style="text-align:center;margin-top:60px">
      <h2 style="margin:0 0 8px;font-weight:900">{% trans "Enter verification code" %}</h2>
      <div class="muted">{% trans "We sent a code to" %} {{ masked_phone }}</div>

      <form method="post" style="margin-top:22px">
        {% csrf_token %}
        <div class="salla-otp">
          {{ form.d1 }}{{ form.d2 }}{{ form.d3 }}{{ form.d4 }}
        </div>
        {% for e in form.non_field_errors %}<div class="error" style="text-align:center;margin-top:10px">{{e}}</div>{% endfor %}
        <div style="margin-top:14px;text-align:center">
          <a href="{% url 'accounts:logout' %}" style="color:#ef4444;text-decoration:none">{% trans "Logout" %}</a>
          <span class="muted"> | </span>
          <a href="{% url 'accounts:resend_otp' %}" style="text-decoration:none">{% trans "Resend" %}</a>
        </div>

        <button class="salla-primary" type="submit" style="max-width:420px">{% trans "Verify" %}</button>
      </form>
    </div>
  </div>
</div>

<script>
  // auto move focus
  const inputs = Array.from(document.querySelectorAll(".salla-otp input"));
  inputs.forEach((inp, idx) => {
    inp.addEventListener("input", () => {
      if (inp.value && idx < inputs.length-1) inputs[idx+1].focus();
    });
    inp.addEventListener("keydown", (e) => {
      if (e.key === "Backspace" && !inp.value && idx>0) inputs[idx-1].focus();
    });
  });
  if (inputs[0]) inputs[0].focus();
</script>
{% endblock %}
